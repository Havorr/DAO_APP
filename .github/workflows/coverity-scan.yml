      - name: Download Coverity (with retry)
        env:
          COVERITY_SCAN_TOKEN: ${{ secrets.COVERITY_SCAN_TOKEN }}
        run: |
          set -euo pipefail
          mkdir -p coverity

          for i in 1 2 3; do
            echo "Attempt $i"
            curl -fL --retry 5 --retry-delay 10 \
              -X POST \
              --data "token=${COVERITY_SCAN_TOKEN}&project=${GITHUB_REPOSITORY}" \
              https://scan.coverity.com/download/linux64 \
              -o coverity.tgz && break
            sleep 10
          done

          tar -xzf coverity.tgz -C coverity --strip 1
